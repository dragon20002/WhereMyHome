# Weher My Home

ì§‘ ë©”ëª¨í•˜ëŠ” ì–´í”Œ

## í™”ë©´ ì„¤ëª…

### 1. ì§‘ ëª©ë¡ í™”ë©´

- ì§‘ ì´ë¦„/ë³´ì¦ê¸ˆ/ì›”ì„¸/ê´€ë¦¬ë¹„/Q&Aì ìˆ˜ ì •ë³´ë¥¼ í‘œì‹œ

- ìˆ˜ì •(ğŸ–) ë²„íŠ¼ì„ ëˆŒëŸ¬ í•­ëª© ìˆ˜ì •

- ì¶”ê°€(â•) ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒˆë¡œìš´ ì§‘ ì •ë³´ ì¶”ê°€

  ![ëª©ë¡](readme_img/1-home-list.jpg)

### 2. ì§‘ ìƒì„¸ í™”ë©´

- ì¹´ë©”ë¼(ğŸ“·) ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒˆë¡œìš´ ì‚¬ì§„ ì°ê¸°

- ì‚¬ì§„ì„ ëˆŒëŸ¬ ì „ì²´í™”ë©´ìœ¼ë¡œ ë³´ê¸°

- ì§€ë„(ğŸ—º) ë²„íŠ¼ì„ ëˆŒëŸ¬ í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°

- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìˆ˜ì •ì‚¬í•­ì´ ì €ì¥ë¨

  ![ìƒì„¸](readme_img/2-home-details.jpg)


### 3. ì‚¬ì§„ ì „ì²´í™”ë©´

- ë’¤ë¡œê°€ê¸°ë‚˜ í™”ë©´ í„°ì¹˜ í›„ í‘œì‹œë˜ëŠ” 'ë‹«ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‚˜ê°

  ![ì „ì²´í™”ë©´](readme_img/3-full-screen-img.jpg)

### 4. Q&A ì‘ì„±

- ì…ë ¥ì€ +-ì •ìˆ˜ì™€ ì°¸ê±°ì§“

- ë¹„ê³ (Â·Â·Â·) ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¹„ê³  í•­ëª© ì‘ì„±í•˜ëŠ” íŒì—… ë…¸ì¶œ

  ![QandA](readme_img/4-home-qanda.png)  

### 5. ë¹„ê³  ì‘ì„± íŒì—…

- ì‘ì„± í›„ ì €ì¥

  ![remark](readme_img/5-home-remark.png)

### 6. í˜„ì¬ ìœ„ì¹˜ ì§€ë„

- í˜„ì¬ ìœ„ì¹˜ë¥¼ í‘œì‹œí•¨

- ë’¤ë¡œê°€ê¸°ë¥¼ ëˆ„ë¥´ë©´ í˜„ì¬ ìœ„ì¹˜ì˜ ì£¼ì†Œë¥¼ ìƒì„¸í™”ë©´ì˜ 'ìœ„ì¹˜' ì…ë ¥ë€ì— ì €ì¥

  ![map](readme_img/6-home-location-map.png)

## ê°œì„ í•  ì 

- Q&A ì ìˆ˜ê°€ í•­ëª©ë³„ ê°€ì¤‘ì¹˜ê°€ ì—†ì–´ ì˜ë¯¸ì—†ìŒ

- ì§€ë„(ğŸ—º) ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë°”ë¡œ í˜„ì¬ ìœ„ì¹˜ë¥¼ ì°¾ê¸° ë•Œë¬¸ì— ì´ì „ì— ì…ë ¥í–ˆë˜ ì •ë³´ê°€ ì§€ì›Œì§. ì§€ë„ í™”ë©´ ë‚´ë¶€ì— 'í˜„ì¬ìœ„ì¹˜ ì°¾ê¸°' ë²„íŠ¼ì„ ë³„ë„ ì¶”ê°€ í•„ìš”

- ê·¸ë¦¬ê³  ê°€ì¥ ì¤‘ìš”í•œ ì‹¤ì‚¬ìš© í›„ê¸°... ëŒ€ì¶© ë§Œë“¤ì–´ì„œ ì‹¤ì œ ì‚¬ìš©í•´ë´¤ëŠ”ë° ë°©ì„ ê¸ˆë°©ê¸ˆë°© ë³´ë‹¤ë³´ë‹ˆ ì¡°ëª©ì¡°ëª© ì²´í¬í•˜ê¸° ê·€ì°®ì•„ì ¸ì„œ ì‹¤ì œ ì“¸ëª¨ëŠ” ì—†ì„ ê²ƒ ê°™ë‹¤.

## ViewModel

- `ViewModel`

```java
class ItemViewModel : ViewModel() {
    /**
     * db ì‚¬ìš©í•  ê²½ìš° RoomDatabase êµ¬í˜„ì²´ë‚˜ Daoë¥¼ ì„ ì–¸í•œë‹¤.
     *
     * view modelê³¼ ë¶„ë¦¬í•´ì„œ ì¡°íšŒ ê²°ê³¼ë§Œ setterë¡œ ë„£ì–´ì¤˜ 'ê²°í•©ë„'ë¥¼ ë‚®ì¶œ ìˆ˜ ìˆì§€ë§Œ...
     * ê·€ì°®ì•„ì„œ ê·¸ëƒ¥ view model ì•ˆì—ë‹¤ ì„ ì–¸í•¨
     */
    var db: AppDatabase? = null

    /**
     * Observable (LiveData) ì •ì˜
     *
     * ë°ì´í„°ì†ŒìŠ¤(DB, Network ë“±)ë¡œë¶€í„° viewModel ê°’ì„ ë°›ì•„ì˜¤ëŠ” ì—­í• ì„ í•œë‹¤.
     * LiveDataê°€ ê°’ì„ ë°›ì•„ì˜¤ë©´ observerë“¤ì€ ë·°ì— ê°’ì„ ê°±ì‹ í•˜ëŠ” ì‘ì—…ì„ í•´ì£¼ë©´ ëœë‹¤.
     */
    val itemLiveData = MutableLiveData<Item>()

    /**
     * Observable ì •ì˜
     * 
     * ObservableXXXëŠ” ê°’ì´ ë³€ê²½ë˜ë©´ ì—°ê²°ëœ layout viewë¥¼ ê°±ì‹ í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
     */
    val name = ObservableField<String>()
    val address = ObservableField<String>()
    val deposit = ObservableField<String>()
    val rental = ObservableField<String>()
    val expense = ObservableField<String>()
    val startDate = ObservableField<String>()
    val endDate = ObservableField<String>()
    val pictureList: ObservableList<DummyContent.Picture> = ObservableArrayList()
    val qandaList: ObservableList<DummyContent.QandaViewData> = ObservableArrayList()

    fun init(db: AppDatabase) {
        this.db = db
    }

    // dbì—ì„œ idë¡œ item ì¡°íšŒ
    fun setItemId(itemId: String) {
        Thread { // item ë¡œë“œ
            db?.homeInfoDao()?.loadAllByIds(arrayOf(itemId))?.takeIf {
                it.isNotEmpty()
            }?.get(0)?.let { homeInfo ->
                itemLiveData.postValue(homeInfo)
            }
        }.start()
    }

    // dbì— item ì €ì¥/ìˆ˜ì •
    suspend fun saveItem(): Item { ... }
}
```

- `View`

```java
class ItemFragment : Fragment() {
    ...
    private var viewModel: ItemViewModel? = null
    private var binding: ItemFragmentBinding? = null

    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        binding = DataBindingUtil.inflate(inflater, R.layout.item_fragment, container, false)
        val view = binding?.root

        ...view?.findViewById....

        // ê¸°ì¡´ viewModelì´ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        if (viewModel != null) {
            viewModel = ViewModelProvider(this).get(ItemViewModel::class.java).apply {
                init(AppDatabase.getDatabase(requireContext()))
                itemLiveData.removeObservers(viewLifecycleOwner)

                // db -> liveData
                itemLiveData.observe(viewLifecycleOwner, { it ->
                    // [dataBinding ì‚¬ìš©] liveData -> observable -> view ì ìš©
                    name.set(it.name)
                    address.set(it.address)
                    deposit.set(it.deposit.toString())
                    rental.set(it.rental.toString())
                    expense.set(it.expense.toString())
                    startDate.set(it.startDate)
                    endDate.set(it.endDate)
                    pictureList.addAll(it.pictures)
                    qandaList.addAll(it.qandas)

                    // [dataBinding ì‚¬ìš©ì•ˆí•˜ëŠ” ê²½ìš°] ë·°ì— ì§ì ‘ ë„£ì–´ì¤˜ì•¼ í•œë‹¤
                    // ...findViewById(...)?.setText(it.name)...
                })
            }
        }

        binding?.viewModel = viewModel

        // ì´ˆê¸°í™”
        if (arguments == null) { // Add Mode
            viewModel?.itemLiveData?.postValue(createDummyItem())
            viewModel?.pictureList?.addAll(ArrayList())
            viewModel?.qandaList?.addAll(createDummyQandaList())
        } else { // Edit Mode
            arguments?.getString("itemId")?.let {
                viewModel?.setItemId(it)
            }
        }

        return view
    }

    fun someFunction() {
        // ë·° ì…ë ¥ê°’ ë³€ê²½í•˜ë ¤ë©´...
        // android:text="@={item.name}"
        viewModel?.name?.set("change it")

        // ë·° ì…ë ¥ê°’ ì¡°íšŒ
        // android:text="@{item.name}" // ë‹¨ë°©í–¥ ë°”ì¸ë”© (ì‚¬ìš©ìê°€ ìˆ˜ì •í•œ ê°’ì€ ì¡°íšŒë¶ˆê°€)
        // android:text="@={item.name}" // ì–‘ë°©í–¥ ë°”ì¸ë”© (ì‚¬ìš©ìê°€ ìˆ˜ì •í•œ ê°’ì€ ì¡°íšŒê°€ëŠ¥)
        viewModel?.name?.get()

        // ë¦¬ìŠ¤íŠ¸ í•­ëª© ì¶”ê°€ì‚¬í•­ì„ ë·°ì— ì ìš© í•˜ë ¤ë©´...
        // [listAdapter ì‚¬ìš© ì‹œ] <ListView android:adapter=@{pictureListAdapter} ...>
        // [BindingAdapter ì‚¬ìš© ì‹œ] @BindingAdapter í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ì—¬ ì§ì ‘ ë°”ì¸ë”©
        viewModel?.pictureList?.add(...)
    }
}
```

## NavController

- Fragment ê°„ ì´ë™ì„ @navigation/nav_graph.xmlì— ëª…ì‹œì ìœ¼ë¡œ ì‘ì„±í•˜ì—¬ FragmentTransaction ë³´ë‹¤ ì‰½ê³  í¸í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

- `@navigation`

```xml
<?xml version="1.0" encoding="utf-8"?>
<navigation xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/nav_graph"
    app:startDestination="@id/ItemFragment">

    <fragment
        android:id="@+id/ItemFragment"
        android:name="com.minuminu.haruu.wheremyhome.ItemFragment"
        android:label="@string/item_fragment_label"
        tools:layout="@layout/item_fragment">

        <action
            android:id="@+id/action_ItemFragment_to_PictureFullScreenFragment"
            app:destination="@id/PictureFullScreenFragment" />
        <action
            android:id="@+id/action_ItemFragment_to_MapsFragment"
            app:destination="@id/MapsFragment" />
    </fragment>
    <fragment
        android:id="@+id/PictureFullScreenFragment"
        android:name="com.minuminu.haruu.wheremyhome.PictureFullscreenFragment"
        android:label="ì „ì²´í™”ë©´"
        tools:layout="@layout/fragment_picture_fullscreen">
    </fragment>
    <fragment
        android:id="@+id/MapsFragment"
        android:name="com.minuminu.haruu.wheremyhome.MapsFragment"
        android:label="ì§€ë„"
        tools:layout="@layout/fragment_maps" />
```

- `ì´ë™`

```java
import androidx.navigation.fragment.findNavController
...
findNavController().navigate(
    R.id.action_ItemFragment_to_MapsFragment,
    Bundle().apply {
        putString("address", address)
    })
```

- `ì´ì „ Fragmentë¡œ ì´ë™`

```java
findNavController().popBackStack(R.id.ItemFragment, false)
```

- `Bundle ë°ì´í„° ë³€ê²½ ë¦¬ìŠ¤ë„ˆ`

```java
findNavController().addOnDestinationChangedListener { _, dest, args ->
    when (dest.id) {
        R.id.MapsFragment -> {
            args?.getString("address")?.let { address ->
                Log.d(javaClass.name, "address - observe $address")
            }
        }
    }
}
```

- `Bundle ë°ì´í„° ë³€ê²½`

```java
// Notify data changed
arguments?.putString("address", address)
```

## License

> ì•± ì•„ì´ì½˜ ì œì‘ì <a href="https://www.flaticon.com/kr/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/kr/" title="Flaticon"> www.flaticon.com</a>

> <a href="https://www.flaticon.com/authors/dmitri13" title="dmitri13">dmitri13</a> from <a href="https://www.flaticon.com/" title="Flaticon"> www.flaticon.com</a>